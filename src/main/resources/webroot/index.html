<!DOCTYPE html>
<html class="no-js" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <base href="."/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Home | Sparrow RecSys</title>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="theme-color" content="#ffffff"/>
    <link type="text/plain" rel="author"/>
    <link href="./css/style.css" rel="stylesheet"/>
    <!-- æ–°å¢ï¼šå¼•å…¥Font Awesomeï¼ˆä¿®å¤æœç´¢å›¾æ ‡ï¼‰ -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <link rel="shortcut icon" href="./resources/favicon.ico">
    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
    <script src="./js/recsys.js?v=1.20"></script>
    <script src="./js/poster-links.js"></script>
</head>
<body id="root">
<div>
    <header class="base-compact-header">
        <div class="ml4-container base-header-primary-container">
            <div class="base-header-logo-container">
                <span class="base-header-logo-main">
                    <a href="."><img alt="Sparrow RecSys Logo" height="30px" src="./images/sparrowrecsyslogo.png"/></a>
                </span>
            </div>
            <div class="base-header-search-container">
                <form class="form-inline ng-pristine ng-valid ng-touched" novalidate="" role="form">
                    <div class="input-group input-group-sm base-header-search-box">
               <span class="twitter-typeahead" style="position: relative; display: inline-block;">
                   <input class="form-control input-sm no-glow tt-input ng-pristine ng-valid ng-touched"
                          id="omnisearch-typeahead" name="currentVal" type="text" spellcheck="false" dir="auto"
                          aria-owns="omnisearch-typeahead_listbox" role="combobox"
                          aria-readonly="true" aria-autocomplete="list"
                          style="position: relative; vertical-align: top; background-color: transparent;"/>
                </span>
                        <span class="input-group-btn">
                            <button class="btn btn-default btn-sm no-glow">
                                <i class="fa fa-search"></i>
                            </button>
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </header>
    <div class="base-compact-header-spacer"></div>
    <div class="ml4-container" style="min-height: 920px;">
        <div id="main-container">
            <!-- æ¨¡å‹é€‰æ‹©åŒºåŸŸ -->
            <div class="model-selection-section" style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
                <div class="row">
                    <div class="col-md-12">
                        <h4 style="margin-bottom: 15px;">ğŸ¯ æ¨èæ¨¡å‹é€‰æ‹©</h4>
                        <div class="form-group">
                            <label for="modelSelect">é€‰æ‹©embeddingæ¨¡å‹ç‰ˆæœ¬:</label>
                            <select id="modelSelect" class="form-control" style="width: 300px; display: inline-block; margin-left: 10px;">
                                <option value="">åŠ è½½ä¸­...</option>
                            </select>
                            <button id="switchModelBtn" class="btn btn-primary" style="margin-left: 10px;">åˆ‡æ¢æ¨¡å‹</button>
                            <span id="modelStatus" style="margin-left: 10px; font-weight: bold;"></span>
                        </div>
                        <!-- NCFç‰ˆæœ¬æ–‡æ¡ˆè¯´æ˜ï¼ˆä¿ç•™ï¼‰ -->
                        <p class="text-muted" style="margin-top: 10px;">
                            <strong>æ ‡å‡†ç‰ˆæœ¬:</strong> ä½¿ç”¨åŸå§‹æ•°æ®é›†(116ä¸‡æ¡è¯„åˆ†)è®­ç»ƒçš„æ¨¡å‹<br>
                            <strong>å¤§æ•°æ®é›†ç‰ˆæœ¬:</strong> ä½¿ç”¨MovieLens 25Mæ•°æ®é›†(2500ä¸‡æ¡è¯„åˆ†)è®­ç»ƒçš„é«˜è´¨é‡æ¨¡å‹<br>
                            <strong>NCFæ·±åº¦å­¦ä¹ ç‰ˆæœ¬:</strong> åŸºäºç¥ç»ååŒè¿‡æ»¤(NCF)çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œèåˆçº¿æ€§+éçº¿æ€§ç‰¹å¾
                        </p>
                    </div>
                </div>
            </div>

            <div class="frontpage" id="recPage">
                <div class="frontpage-section-top">
                    <div class="row">
                        <div class="col-md-6">
                            <h1>æäº¤æ‚¨çš„æ„è§</h1>
                            <div class="jumbotron ml4-jumbotron" style="padding-top: 0;">
                                <p> ä¸ºäº†æ”¶é›†æ‚¨çš„åé¦ˆï¼Œè¯·åœ¨æˆ‘ä»¬é¡¹ç›®çš„GitHubé¦–é¡µåˆ›å»º issue
                                    <a href="https://github.com/wzhe06/SparrowRecSys/issues"
                                       target="_blank">Sparrow RecSys Github</a>.</p>
                                <p>
                                    <button class="btn btn-primary btn-lg"
                                            onclick="location.href='https://github.com/wzhe06/SparrowRecSys/issues';">
                                        æäº¤æ‚¨çš„æ„è§
                                    </button>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="base-compact-footer">
        <div class="ml4-container">
            <div class="row ml4-footer-row">
                <div class="col-md-2">
                    <ul class="list-unstyled">
                        <li class="header section-header">learn more</li>
                        <li><a href="https://github.com/wzhe06/SparrowRecSys">about
                            Sparrow RecSys</a></li>
                        <li><a
                                href="https://wzhe.me">about Zhe Wang</a></li>
                    </ul>
                </div>
                <div class="col-md-2">
                    <ul class="list-unstyled">
                        <li class="header section-header">Zhe Wang's wechat</li>
                        <li>
                            <img alt="GroupLens logo" src="./images/wzscan.jpg" width="110"/>
                        </li>
                    </ul>
                </div>
                <div class="col-md-5 col-md-offset-1">
                    <div class="gl-logo section-header">
                        <img alt="GroupLens logo" height="25"
                             src="./resources/grouplens-logo-110.png" width="110"/>
                    </div>
                    <p> Sparrow RecSys is an open source recommender system, which is founded and maintained by <a href="https://github.com/wzhe06">Wang Zhe</a>, a senior machine learning engineer. </p>
                    <p> version 1.0.0
                        <!----></p>
                    <p>copyright &copy; 2020</p>
                </div>
            </div>
        </div>
    </footer>
</div>
</body>

<script type="text/javascript">
    window.onload = function() {
        console.log("Window loaded, starting...");

        var getUrl = window.location;
        var baseUrl = getUrl.protocol + "//" + getUrl.host + "/"

        console.log("å¼€å§‹åŠ è½½æ¨èå†…å®¹...");
        console.log("baseUrl:", baseUrl);

        // 1. åŠ è½½æ¨¡å‹åˆ—è¡¨ï¼ˆä¼˜åŒ–NCFé€‚é…ï¼‰
        function loadModelList() {
            console.log("å¼€å§‹åŠ è½½æ¨¡å‹åˆ—è¡¨...");
            $("#modelStatus").text("æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...").css("color", "blue");
            $.ajax({
                url: baseUrl + "getmodel?action=list",
                type: "GET",
                dataType: "json",
                timeout: 5000, // æ–°å¢ï¼š5ç§’è¶…æ—¶ï¼ˆåŠ è½½æ¨¡å‹åˆ—è¡¨ï¼Œå’ŒNCFåˆ‡æ¢æ— å…³ï¼Œä¿ç•™ï¼‰
                success: function(res) {
                    console.log("æ¨¡å‹åˆ—è¡¨æ¥å£è¿”å›ï¼š", res);
                    if (res.success) {
                        // æ¸…ç©ºä¸‹æ‹‰æ¡†
                        $("#modelSelect").empty();
                        // éå†æ¨¡å‹åˆ—è¡¨ï¼ˆå…¼å®¹ä¸­è‹±æ–‡displayNameï¼‰
                        $.each(res.models, function(i, model) {
                            var displayName = model.displayName;
                            // ç»Ÿä¸€åç§°æ˜¾ç¤ºï¼ˆåç«¯è‹±æ–‡è½¬ä¸­æ–‡ï¼‰
                            if (model.version === "STANDARD") {
                                displayName = "æ ‡å‡†ç‰ˆæœ¬";
                            } else if (model.version === "LARGE") {
                                displayName = "å¤§æ•°æ®é›†ç‰ˆæœ¬";
                            } else if (model.version === "NCF") {
                                displayName = "NCFæ·±åº¦å­¦ä¹ ç‰ˆæœ¬"; // å¼ºåˆ¶æ˜ å°„NCFåç§°
                            }
                            // æ–°å¢ï¼šç»™NCFé€‰é¡¹åŠ ç‰¹æ®Šæ ‡è¯†
                            var option = $("<option>").val(model.version).text(displayName);
                            if (model.version === "NCF") {
                                option.attr("title", "åŸºäºç¥ç»ååŒè¿‡æ»¤çš„æ·±åº¦å­¦ä¹ æ¨¡å‹"); // é¼ æ ‡æ‚¬æµ®æç¤º
                            }
                            $("#modelSelect").append(option);
                            // é»˜è®¤é€‰ä¸­å½“å‰æ¨¡å‹
                            if (model.isCurrent) {
                                $("#modelSelect").val(model.version);
                                $("#modelStatus").text("å½“å‰æ¨¡å‹ï¼š" + displayName).css("color", "green");
                            }
                        });
                    } else {
                        $("#modelSelect").html('<option value="">åŠ è½½å¤±è´¥</option>');
                        $("#modelStatus").text("åŠ è½½å¤±è´¥ï¼š" + res.message).css("color", "red");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("æ¨¡å‹åˆ—è¡¨åŠ è½½å¤±è´¥ï¼š", error);
                    $("#modelSelect").html('<option value="">åŠ è½½å¤±è´¥</option>');
                    if (status === "timeout") {
                        $("#modelStatus").text("åŠ è½½å¤±è´¥ï¼šè¯·æ±‚è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢").css("color", "red");
                    } else {
                        $("#modelStatus").text("åŠ è½½å¤±è´¥ï¼šæ— æ³•è¿æ¥æœåŠ¡å™¨").css("color", "red");
                    }
                }
            });
        }

        // 2. åˆ‡æ¢æ¨¡å‹ï¼ˆä¼˜åŒ–NCFåˆ‡æ¢ä½“éªŒï¼Œç§»é™¤è¶…æ—¶é™åˆ¶ï¼‰
        function switchModel() {
            var selectedVersion = $("#modelSelect").val();
            if (!selectedVersion) {
                $("#modelStatus").text("è¯·é€‰æ‹©æ¨¡å‹ç‰ˆæœ¬ï¼").css("color", "orange");
                return;
            }
            // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
            $("#switchModelBtn").prop("disabled", true).text("åˆ‡æ¢ä¸­...");
            $("#modelStatus").text("æ­£åœ¨åˆ‡æ¢æ¨¡å‹ï¼Œè¯·ç¨å€™...").css("color", "blue");

            $.ajax({
                url: baseUrl + "getmodel",
                type: "POST",
                data: {
                    action: "switch",
                    version: selectedVersion
                },
                dataType: "json",
                // ========== æ ¸å¿ƒä¿®æ”¹ï¼šåˆ é™¤timeout: 10000è¿™ä¸€è¡Œï¼Œä¸è®¡ç®—æ—¶é—´ ==========
                success: function(res) {
                    if (res.success) {
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        var modelName = selectedVersion === "STANDARD" ? "æ ‡å‡†ç‰ˆæœ¬" : 
                                        selectedVersion === "LARGE" ? "å¤§æ•°æ®é›†ç‰ˆæœ¬" : "NCFæ·±åº¦å­¦ä¹ ç‰ˆæœ¬";
                        $("#modelStatus").text("âœ… æˆåŠŸåˆ‡æ¢åˆ°ï¼š" + modelName).css("color", "green");
                        // åˆ·æ–°æ¨èå†…å®¹ï¼ˆä¸åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼Œä»…é‡æ–°åŠ è½½æ¨èè¡Œï¼‰
                        setTimeout(function() {
                            reloadRecommendations(baseUrl); // æ–°å¢ï¼šå±€éƒ¨åˆ·æ–°æ¨è
                            $("#switchModelBtn").prop("disabled", false).text("åˆ‡æ¢æ¨¡å‹");
                        }, 1000);
                    } else {
                        $("#modelStatus").text("âŒ åˆ‡æ¢å¤±è´¥ï¼š" + res.message).css("color", "red");
                        $("#switchModelBtn").prop("disabled", false).text("åˆ‡æ¢æ¨¡å‹");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("æ¨¡å‹åˆ‡æ¢å¤±è´¥ï¼š", error);
                    // ========== å¾®è°ƒï¼šç§»é™¤è¶…æ—¶æç¤ºï¼Œä»…ä¿ç•™ç½‘ç»œé”™è¯¯æç¤º ==========
                    $("#modelStatus").text("âŒ åˆ‡æ¢å¤±è´¥ï¼šç½‘ç»œé”™è¯¯").css("color", "red");
                    $("#switchModelBtn").prop("disabled", false).text("åˆ‡æ¢æ¨¡å‹");
                }
            });
        }

        // 3. å±€éƒ¨åˆ·æ–°æ¨èå†…å®¹ï¼ˆé¿å…æ•´é¡µåˆ·æ–°ï¼Œä¼˜åŒ–ä½“éªŒï¼‰
        function reloadRecommendations(baseUrl) {
            console.log("é‡æ–°åŠ è½½æ¨èå†…å®¹...");
            // æ¸…ç©ºåŸæœ‰æ¨èè¡Œ
            $("#recPage .frontpage-section-top .row").not(":first").remove();
            // é‡æ–°åŠ è½½å„ç±»å‹æ¨è
            addGenreRow('#recPage', 'Action', 'action-collection', 8, baseUrl);
            addGenreRow('#recPage', 'Romance', 'romance-collection', 8, baseUrl);
            addGenreRow('#recPage', 'Thriller', 'thriller-collection', 8, baseUrl);
            addGenreRow('#recPage', 'Comedy', 'comedy-collection', 8, baseUrl);
            addGenreRow('#recPage', 'Drama', 'drama-collection', 8, baseUrl);
            addGenreRow('#recPage', 'Adventure', 'adventure-collection', 8, baseUrl);
        }

        // 4. ç»‘å®šäº‹ä»¶
        $("#switchModelBtn").click(function() {
            switchModel();
        });
        // æ–°å¢ï¼šæŒ‰å›è½¦ä¹Ÿèƒ½åˆ‡æ¢æ¨¡å‹
        $("#modelSelect").keypress(function(e) {
            if (e.which === 13) {
                switchModel();
            }
        });

        // åˆå§‹åŒ–
        loadModelList();
        // åŠ è½½åˆå§‹æ¨è
        //addGenreRow('#recPage', 'Action', 'action-collection', 8, baseUrl);
        //addGenreRow('#recPage', 'Romance', 'romance-collection', 8, baseUrl);
        //addGenreRow('#recPage', 'Thriller', 'thriller-collection', 8, baseUrl);
        //addGenreRow('#recPage', 'Comedy', 'comedy-collection', 8, baseUrl);
        //addGenreRow('#recPage', 'Drama', 'drama-collection', 8, baseUrl);
        //addGenreRow('#recPage', 'Adventure', 'adventure-collection', 8, baseUrl);
    };
</script>
</html>